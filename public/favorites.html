<!--public/favorites.html-->
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velora | Favoriler</title>
    <link rel="stylesheet" href="css/style.css">

     <style>
header {
    background-color: #000;
    padding: 20px 0 10px;
    border-bottom: 2px solid #d4af37;
}

nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
}

nav a {
    color: #f5f5f5;
    text-decoration: none;
    font-weight: 600;
    letter-spacing: 1px;
}

nav a:hover {
    color: #d4af37;
}

@media (max-width: 768px) {

    header {
        position: relative;
        border-bottom: none;
    }

    nav {
        display: none;
        position: absolute;
        top: 70px;
        right: 20px;
        background: black;
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
        border: 1px solid #d4af37;
        z-index: 1000;
    }

    nav.active {
        display: flex;
    }

    .hamburger {
        display: flex;
        flex-direction: column;
        gap: 6px;
        position: absolute;
        top: 25px;
        right: 20px;
        z-index: 1100;
        cursor: pointer;
    }

    .hamburger span {
        width: 28px;
        height: 3px;
        background: #ffffff;
    }
}

</style>
</head>
<body>
<header>
    <h1 style="color: #d4af37;">VELORA</h1>
    <nav id="navMenu">
        <a href="index.html">ANA SAYFA</a>
        <a href="products.html">ÜRÜNLER</a>
        <a href="cart.html">SEPETİM</a>
         <a href="login.html" id="loginLink">GİRİŞ YAP</a>
            <a href="register.html" id="registerLink">KAYIT OL</a>
           <a href="#" id="logoutBtn" class="logout-btn" style="display:none; ">
    ->
</a>
<div id="logoutConfirm" class="logout-confirm">
        <p>Çıkış yapmak istediğine emin misin?</p>
        <button id="confirmYes">Evet</button>
        <button id="confirmNo">Hayır</button>
    </div>
    </nav>
     <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>
</header>

<div class="form-container">
    <h2>FAVORİLERİM</h2>
    <div id="message" class="message"></div>
    <div id="favoriteItems"></div>
</div>

<footer>
    <p>&copy; 2025 VELORA</p>
</footer>

<script>
const favoriteItemsDiv = document.getElementById("favoriteItems");
const messageDiv = document.getElementById("message");

// Favorileri getir
async function loadFavorites() {
    try {
        const token = localStorage.getItem("token");
        if (!token) {
            messageDiv.style.display = "block";
            messageDiv.className = "message error";
            messageDiv.textContent = "Lütfen giriş yapın!";
            return;
        }

        const res = await fetch("/api/favorite", { 
            method: "GET",
            headers: { "Authorization": "Bearer " + token }
        });

        const fav = await res.json();
        
       
        if (fav.success === false) {
             messageDiv.style.display = "block";
             messageDiv.className = "message error";
             messageDiv.textContent = fav.message || "Favoriler yüklenirken hata oluştu (Yetki/Sunucu hatası).";
             return;
        }


        if (!fav.items || fav.items.length === 0) {
            favoriteItemsDiv.innerHTML = "<p>Favorileriniz boş.</p>";
            return;
        }

        favoriteItemsDiv.innerHTML = "";
        fav.items.forEach(item => {
            const div = document.createElement("div");
            div.style.border = "1px solid #d4af37";
            div.style.borderRadius = "12px";
            div.style.padding = "12px";
            div.style.marginBottom = "10px";
            div.style.backgroundColor = "#0d0d0d";
            div.style.display = "flex";
            div.style.justifyContent = "space-between";
            div.style.alignItems = "center";

            div.innerHTML = `
                <span>${item.product.name}</span>
                <div>
                    <button class="addToCartBtn" data-id="${item.product._id}" 
                        style="background:#d4af37;color:#0d0d0d;border:none;padding:5px 10px;border-radius:8px;cursor:pointer;margin-right:5px;">
                        Sepete Ekle
                    </button>
                    <button class="removeFavBtn" data-id="${item.product._id}" 
                        style="background:#ff4c4c;color:#fff;border:none;padding:5px 10px;border-radius:8px;cursor:pointer;">
                        Sil
                    </button>
                </div>
            `;
            favoriteItemsDiv.appendChild(div);
        });

        // Favori sil
        document.querySelectorAll(".removeFavBtn").forEach(btn => {
            btn.addEventListener("click", async () => {
                const id = btn.getAttribute("data-id");
                const res = await fetch("/api/favorite/remove/" + id, { 
                    method: "DELETE",
                    headers: { "Authorization": "Bearer " + token }
                });
                const data = await res.json();
                if(data.success) {
                     loadFavorites();
                } else {
                    alert(data.message || "Favorilerden çıkarma başarısız!");
                }
            });
        });

        // Sepete ekle
        document.querySelectorAll(".addToCartBtn").forEach(btn => {
            btn.addEventListener("click", async () => {
                const productId = btn.getAttribute("data-id");
                const res = await fetch("/api/cart/add", { 
                    method: "POST",
                    headers: { 
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + token
                    },
                    body: JSON.stringify({ productId, quantity: 1 })
                });
                const data = await res.json();
                if(data.success) {
                    messageDiv.style.display = "block";
                    messageDiv.className = "message success";
                    messageDiv.textContent = "Ürün sepete eklendi!";
                } else {
                    messageDiv.style.display = "block";
                    messageDiv.className = "message error";
                    messageDiv.textContent = data.message || "Sepete ekleme başarısız!";
                }
            });
        });

    } catch (err) {
        messageDiv.style.display = "block";
        messageDiv.className = "message error";
        messageDiv.textContent = "Favoriler yüklenirken hata oluştu.";
    }
}

loadFavorites();
</script>
 <script>
const hamburger = document.getElementById("hamburger");
const nav = document.getElementById("navMenu");

hamburger.addEventListener("click", () => {
    nav.classList.toggle("active");
});
const logoutBtn = document.getElementById("logoutBtn");
const logoutConfirm = document.getElementById("logoutConfirm");
const yesBtn = document.getElementById("confirmYes");
const noBtn = document.getElementById("confirmNo");

logoutConfirm.style.display = "none";

if (localStorage.getItem("token")) {
    logoutBtn.style.display = "inline-block";
}


logoutBtn.addEventListener("click", (e) => {
    e.preventDefault();
    logoutConfirm.style.display = "block";
});


noBtn.addEventListener("click", () => {
    logoutConfirm.style.display = "none";
});


yesBtn.addEventListener("click", () => {
    localStorage.removeItem("token");
    logoutConfirm.innerHTML = "<p>Çıkış yapıldı</p>";

    setTimeout(() => {
        logoutConfirm.style.display = "none";
        logoutBtn.style.display = "none";
    }, 1200);
});

const loginLink = document.getElementById("loginLink");
const registerLink = document.getElementById("registerLink");

if (localStorage.getItem("token")) {
    loginLink.style.display = "none";
    registerLink.style.display = "none";
    logoutBtn.style.display = "inline-block";
} else {
    loginLink.style.display = "inline-block";
    registerLink.style.display = "inline-block";
    logoutBtn.style.display = "none";
}

</script>
</body>
</html>