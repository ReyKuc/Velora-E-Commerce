<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Velora | Siparişlerim</title>
<link rel="stylesheet" href="css/style.css">

<style>
/* === PRODUCTS.HTML İLE AYNI HEADER === */
header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
}


nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
}

nav a {
    color: #f5f5f5;
    text-decoration: none;
    font-weight: 600;
    letter-spacing: 1px;
}

nav a:hover {
    color: #d4af37;
}

@media (max-width: 768px) {
   header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
}


    nav {
        display: none;
        position: absolute;
        top: 70px;
        right: 20px;
        background: black;
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
        border: 1px solid #d4af37;
        z-index: 1000;
    }

    nav.active {
        display: flex;
    }

    .hamburger {
        display: flex;
        flex-direction: column;
        gap: 6px;
        position: absolute;
        top: 25px;
        right: 20px;
        z-index: 1100;
        cursor: pointer;
    }

    .hamburger span {
        width: 28px;
        height: 3px;
        background: #ffffff;
    }
}

/* === SAYFA GÖVDESİ === */
.order-card {
    border: 1px solid #d4af37;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 20px;
    background-color: #0d0d0d;
     display: flex;
    flex-direction: column;
    gap: 15px;

}

.order-date {
    color: #aaa;
    margin-bottom: 15px;
    display: block;
    border-bottom: 1px solid #333;
    padding-bottom: 10px;
}
.order-items-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}
.order-product-row {
    display: grid;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px; /* Her ürün satırı arası boşluk */
    padding: 10px;
    background: #151515;
    border-radius: 8px;
}
.order-product-image {
    width: 80px !important;
    height: 80px !important;
    object-fit: cover;
    border-radius: 8px;
    flex-shrink: 0; /* Resmin daralmasını önler */
}
.product-info-box {
    display: flex;
    align-items: center;
    gap: 15px;
}

.order-total {
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid #333;
    text-align: right;
    font-weight: bold;
    color: #d4af37;
}
#ordersList {
    max-width: 900px;
    margin: 0 auto;
}


/* === GOLD BUTON (VELORA STYLE) === */
.review-btn {
    background-color: #d4af37;
    color: #000;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}

.review-btn:hover {
    background-color: #e0b84f;
    transform: scale(1.05);
}


/* === MODAL === */
.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    z-index: 2000;
}

.modal-content {
    background: #1f1f1f;
    border: 2px solid #d4af37;
    border-radius: 15px;
    padding: 30px;
    max-width: 400px;
    margin: 10% auto;
    text-align: center;
}

.stars span {
    font-size: 28px;
    cursor: pointer;
    color: #ffd700;
}

textarea {
    width: 100%;
    height: 90px;
    background: #000;
    color: #fff;
    border: 1px solid #d4af37;
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
}

.submit-btn {
    margin-top: 15px;
    width: 100%;
    padding: 10px;
    background: #d4af37;
    color: #000;
    border: none;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
}
  
</style>
</head>

<body>

<header>
<h1 style="color:#d4af37;">VELORA</h1>
<nav id="navMenu">
    <a href="index.html">ANA SAYFA</a>
    <a href="products.html">ÜRÜNLER</a>
    <a href="cart.html">SEPETİM</a>
  
    <a href="favorites.html">FAVORİLER</a>
    <a href="#" id="logoutBtn" style="display:none;">→</a>
</nav>
<div class="hamburger" id="hamburger">
    <span></span><span></span><span></span>
</div>
</header>

<div class="form-container">
<h2>Sipariş Geçmişim</h2>
<div id="ordersList">Yükleniyor...</div>
</div>

<!-- MODAL -->
<div id="reviewModal" class="modal">
<div class="modal-content">
<h3 id="modalProductName" style="color:#d4af37;">Değerlendir</h3>
<div class="stars" id="stars">
<span onclick="setRating(1)">☆</span>
<span onclick="setRating(2)">☆</span>
<span onclick="setRating(3)">☆</span>
<span onclick="setRating(4)">☆</span>
<span onclick="setRating(5)">☆</span>
</div>
<textarea id="reviewComment" style="font-family: Arial, Helvetica, sans-serif;" placeholder="Yorumunuzu yazın..."></textarea>
<button class="submit-btn" onclick="submitReview()">GÖNDER</button>
<button onclick="closeModal()" style="margin-top:10px;background:none;border:none;color:#aaa;cursor:pointer;">Kapat</button>
</div>
</div>

<script>
const token = localStorage.getItem("token");
let currentProductId = null;
let rating = 0;

if(!token) window.location.href = "login.html";

async function loadOrders() {
    const list = document.getElementById("ordersList");
    const res = await fetch("/api/orders/my-orders", {
        headers:{ "Authorization":"Bearer "+token }
    });
    const orders = await res.json();
    list.innerHTML = "";

    if(orders.length === 0){
        list.innerHTML = "<p>Henüz sipariş yok.</p>";
        return;
    }

    orders.reverse().forEach(order=>{
        const div = document.createElement("div");
        div.className="order-card";

        let products = order.items.map(i=>`

<div class="order-product-row">
                <div class="product-info-box">
                    <img src="${i.product.image}" alt="${i.product.name}" class="order-product-image">
                <span>${i.product.name} - ${i.price}₺</span>
                <button class="review-btn" onclick="openModal('${i.product._id}','${i.product.name}')">Değerlendir</button>
            </div>
        `).join("");

        div.innerHTML=`
            <span class="order-date">${new Date(order.createdAt).toLocaleDateString()}</span>
            ${products}
            <div class="order-total">Toplam: ${order.totalAmount}₺</div>
        `;
        list.appendChild(div);
    });
}

function openModal(id,name){
    currentProductId=id;
    document.getElementById("modalProductName").innerText=name;
    document.getElementById("reviewModal").style.display="block";
    rating=0; updateStars();
}

function closeModal(){ document.getElementById("reviewModal").style.display="none"; }

function setRating(n){ rating=n; updateStars(); }

function updateStars(){
    [...document.getElementById("stars").children]
    .forEach((s,i)=>s.innerText=i<rating?"★":"☆");
}

async function submitReview(){
    if(!rating) return alert("Puan seç!");
    const comment=document.getElementById("reviewComment").value;
    await fetch(`/api/products/${currentProductId}/review`,{
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+token
        },
        body:JSON.stringify({rating,comment})
    });
    closeModal();
    alert("Teşekkürler!");
}

const hamburger=document.getElementById("hamburger");
const nav=document.getElementById("navMenu");
hamburger.onclick=()=>nav.classList.toggle("active");

const logoutBtn=document.getElementById("logoutBtn");
logoutBtn.style.display="inline";
logoutBtn.onclick=()=>{localStorage.clear();window.location.href="index.html";};

loadOrders();
</script>

</body>
</html>
